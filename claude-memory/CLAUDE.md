# CLAUDE.md

## 核心流程指引

所有过程都应遵循@CLAUDE-appointment.md（开发任务）或@CLAUDE-appointment-general.md（通用任务）。

各类过程开始时、结束时都应检查@CLAUDE-check.md。

重要！！！：必须先完成**任务内容预处理**，且全过程遵循**任务管理和分步提交要求**。

## 任务管理和分步提交要求

### 任务跟踪管理

**TodoWrite工具使用强制要求**：
- 所有复杂任务（3个以上步骤）必须使用TodoWrite工具进行跟踪
- **关键要求**：每个主要步骤完成后必须立即添加对应的"提交变更"待办事项
- 待办事项必须包含具体的提交内容描述

### 分步提交强制机制

**什么构成"一个步骤"**：
1. **单个文件的重要修改**：对任何文档进行重要内容修改后
2. **功能模块的完成**：完成一个相对独立的功能模块后  
3. **阶段性成果**：达成某个阶段性目标后
4. **问题修复**：修复一个具体问题后

**强制提交流程**：
1. **立即提交**：完成上述任何一个"步骤"后，必须立即进行git提交
2. **禁止批量提交**：严禁将多个步骤的变更合并为一次提交
3. **提交信息规范**：每次提交必须清晰描述该步骤的具体变更内容
4. **TodoWrite同步**：每次提交后立即更新TodoWrite状态为completed

## 任务内容预处理

### 预处理概述

**任务内容预处理**是对now-task.md进行的分析优化工作，目的是理解任务内容和目的，结合项目的全面分析进行优化确认，生成清晰完整的执行方案。

### 预处理流程

#### 1. 任务分析阶段

1. **全面分析now-task.md内容**
   - 理解任务的核心目标和具体要求
   - 识别任务的复杂度和涉及范围
   - 分析任务与项目现有结构的关系

2. **项目环境分析** 
   - 根据任务复杂度审阅相关内容
   - 分析项目结构、现有规范、相关文档
   - 研究类似任务的处理方式和经验

3. **复杂度评估**
   - 判断是否需要使用Sequential-Thinking进行结构化分析
   - 识别任务中的多层含义、多个子目标或复杂业务逻辑

#### 2. 任务内容优化阶段

1. **准确性优化**
   - 检查任务描述的准确性和完整性
   - 识别歧义和不明确之处
   - 明确任务边界和成功标准

2. **简洁性优化** 
   - 识别和处理冗余表述
   - 区分真实冗余与必要的重复强调
   - 确保表达简洁但不失准确性

3. **可执行性优化**
   - 将抽象要求转化为具体可执行的步骤
   - 确保每个步骤都有明确的输入、输出和验证标准
   - 考虑执行顺序和依赖关系

#### 3. 待定项处理机制

**重要说明**：任务优化过程中需要用户确认的地方，按以下流程处理：

1. **记录待定项**：参考@undetermined-template.md格式，将待定项写入undetermined.md
2. **统一确认**：完整分析后统一向用户确认所有待定项
3. **结果整理**：用户确认后删除不采纳的待定项，多方案待定项仅保留采纳方案
4. **方案唯一性**：确保每个保留待定项只有唯一实施方案
5. **结果整合**：将确认结果整合到optimized-task.md

#### 4. 优化结果生成

1. **生成optimized-task.md**
   - 包含优化后的完整任务描述
   - 明确的执行步骤和验证标准
   - 整合用户确认的待定项结果

2. **质量验证**
   - 确保优化后的任务描述清晰、准确、可执行
   - 验证任务目标与原始需求的一致性
   - 确认所有关键决策点都已明确

### 异常处理和质量保证

1. **用户沟通处理**
   - 用户不配合删除待定项时再次澄清确认
   - 遇到模糊需求时主动询问，不做假设

2. **质量检查标准**
   - 任务描述准确性检查
   - 执行步骤完整性检查  
   - 成功标准明确性检查

3. **回滚和重分析机制**
   - 保持预处理过程的可回滚性
   - 必要时重新进行分析和优化
   - 记录重要决策的原因和过程

### 预处理完成后的执行

1. **按optimized-task.md执行**：严格按照优化后的任务内容进行执行
2. **过程监控**：执行过程中持续验证是否符合预期目标
3. **任务完成清理**：执行完成后删除optimized-task.md等临时文件

