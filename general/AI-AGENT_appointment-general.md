# 通用任务执行要求

## 前置准备

### 文档检阅要求
- **必须在每次开始任务之前，重新检阅相关指导文档**
- 确保理解最新的规范和要求
- 检查是否有新的约定或变更

### 时间处理规范
- **获取实时时间**：必须在每一次要用到实时时间时，执行以下命令获取本地时间：
  ```python
  python -c "import datetime; print(datetime.datetime.today())"
  ```
- **禁止假设时间**：不要使用硬编码的时间或假设的日期
- **时间格式**：根据具体需求使用适当的时间格式

### 复杂问题分析规范
- **问题复杂度识别**：当发现看似简单的问题实际包含多层含义、多个子目标或复杂逻辑时，必须使用分步思考方法
- **Sequential-Thinking服务**：对于复杂问题，必须调用sequential-thinking服务进行结构化思考分析
- **分步分析标准**：
  - 问题涉及多个领域或模块
  - 需求描述中隐含多个功能点
  - 实现路径存在多种可能性需要权衡
  - 涉及复杂的规则或约束条件
- **思考过程记录**：将分析过程和关键决策点记录到相关文档中

## 核心执行流程

遵循**设计优先**的执行原则，确保在开始执行前完成充分的流程设计：

```
检阅相关文档 → 任务流程设计 → 执行任务 → 验证结果 → 文档更新 → 记录变更
```

### 1. 任务流程设计阶段

采用迭代式设计方法，重复执行以下循环直至流程完全明确：

```
识别不明确点 → 分析决策 → 更新文档 → 验证完整性
```

### 2. 不明确点识别标准

在设计过程中主动识别并处理以下类型的问题：

#### 🔍 **歧义性问题**
- **识别标准**：存在多种可能的解释或实现方案
- **处理方式**：列举所有可能选项，明确询问用户选择

#### 🎯 **目的不明确**  
- **识别标准**：功能目标或需求表述模糊
- **处理方式**：分析可能的意图，提供选项供用户确认

#### ⚡ **优化机会**
- **识别标准**：当前方案可行但存在更优解决方案  
- **处理方式**：对比当前方案与优化方案的差异，征求用户意见

#### ❓ **未知问题处理**
- **识别标准**：遇到未知问题或非常模糊的情况
- **处理方式**：必须明确表示"我不知道"，并询问用户

### 3. 执行与验证阶段

#### 执行规范
- 遵循任务既定的标准和约定
- 优先改进现有内容而非重新开始
- 保持内容的可读性和可维护性

#### 验证要求
- 确保达到预期目标
- 验证各部分功能正常
- 确保所有验证通过后才进入下一阶段

### 4. 设计完成标准

- [ ] 总览流程已绘制并涵盖所有主要功能
- [ ] 复杂模块已提取为独立部分
- [ ] 各模块接口定义清晰（输入/输出/处理逻辑）
- [ ] 关键决策点已明确定义
- [ ] 异常处理路径已考虑
- [ ] 模块间依赖关系已明确

## 版本控制与记录管理

### 分步提交规范
在执行任务过程中必须遵循以下提交策略：

1. **任务开始检查**
   - 检查ai-agent-memory目录下所有以AI_AGENT开头的文件和now-task.md是否有未提交的变更
   - 如有未提交改动，分析改动内容并立即提交，在提交信息中描述当前状态

2. **步骤完成提交**
   - 每完成一个步骤的一批文档修改后，都要先进行仓库提交再进行下一步
   - 确保每个提交都是原子性的，只包含相关的变更
   - 提交信息要清晰描述完成的步骤和变更内容

3. **CHANGELOG维护检查**
   - 在每次提交前检查仓库变更状态，分析变更内容以决定是否需要对CHANGELOG进行修改
   - 不论是什么任务，都应该维护CHANGELOG记录重要变更

### 文档版本管理
- **变更记录**：每次重要修改都应记录变更原因和内容
- **版本标记**：对重要的文档版本进行标记
- **历史保留**：保持重要历史版本的备份

### 完成后的必要操作

在任务完成后必须：

1. **更新相关文档**
   - 把相关的变动写入到指导文档中
   - 记录新增的约定或规范
   - 更新已变更的流程或要求

2. **记录决策过程**
   - 记录重要决策的原因
   - 保留关键的分析过程
   - 建立可追溯的决策链

3. **维护更新日志**
   - 记录版本、日期、变更类型和内容
   - 保持更新记录的清晰和完整

4. **任务完成后清理**
   - 维护CHANGELOG并进行提交，在这一次提交之后：
     - 删除now-task.md中除了第一行之外的所有内容  
     - 删除undetermined.md文件（如存在）
     - 结束掉CHANGELOG中本次的Unreleased，分析应该更新哪一段版本号，更新相应的版本号，添加新的Unreleased

## 质量保证要求

1. **文档同步**：内容变更时同步更新相关文档
2. **决策记录**：重要决策需在相关文档中记录原因  
3. **流程验证**：新任务开始前验证现有流程的准确性
4. **标准遵循**：确保遵循既定的质量标准
5. **回滚准备**：保持可回滚状态，记录回滚步骤
