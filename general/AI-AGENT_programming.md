# AI-AGENT_programming.md

本文件针对编程类任务提供在`AI-AGENT_general.md`基础上的额外要求。执行任何开发、测试、调试行为前，请确认已阅读通用指引并同步更新`AI-AGENT_working-status.md`。

## 通用技术要求
- **原则内化**：全程贯彻KISS、YAGNI、DRY、SOLID原则，主动识别并纠正坏迹象（僵化、冗余、循环依赖、脆弱、晦涩、数据泥团、过度复杂）。
- **交流语言**：所有分析、记录、提交信息均使用简体中文。
- **环境与脚本**：
  - Run & Debug必须通过`scripts/`目录下的`.py`脚本统一启动/停止，不直接调用npm、uv等命令。
  - 运行前配置带文件输出的Logger至`logs/`目录。
  - 若脚本或依赖异常，优先修复脚本再继续任务。
- **时间引用**：需记录时间时使用`python -c "import datetime; print(datetime.datetime.today())"`获取实时值。
- **Sequential-Thinking**：当需求涉及多模块、多方案或复杂业务逻辑时，必须调用Sequential-Thinking服务完成结构化分析。

## 专业化代理与分工
- 根据任务类型选择合适的专业化代理（如`rust-web-developer`、`rust-library-developer`等），必要时在不同阶段切换。
- 大型项目可并行分配不同代理处理独立模块，但要确保流程与接口一致。

## 工作环节要求

### 1. 任务前置准备
- 除通用要求外，重点审阅项目代码结构、依赖清单、已有模块职责及最近提交。
- 检查是否需要新建或更新流程图、架构图、接口协议文档。
- 评估实现所需的运行环境、工具链、第三方服务；记录风险点与前置条件。
- 若涉及Python项目：
  - 确认使用`.venv`作为虚拟环境目录并通过`uv`进行依赖管理。
  - 数据结构应尽量强类型；如需使用动态`dict`必须先征得用户同意。
- 在`optimized-task.md`中明确每个功能模块的完成标准与测试策略。

### 2. 流程设计
- 使用PlantUML描述程序流程，遵守分层设计：
  ```
  program_flowchart/
  ├── src/总览.txt
  ├── src/模块A.txt
  └── png/   (生成的图片)
  ```
- 复杂模块需抽象为独立图，接口以“输入→[模块名]→输出”形式呈现。
- 设计完成后立刻执行：
  ```bash
  java -jar "/home/sayurinana/env-hub/my-tools/jar/plantuml.jar" program_flowchart/src -tpng -o ../png
  ```
  以生成最新的PNG文件。
- 明确模块边界、异常路径、数据流及扩展点，确保满足SOLID原则。
- 若存在多种实现方案，列出对比、计划沟通点与回退策略。

### 3. 任务主体流程循环
- 每实现一个功能单元或完成一次重要重构，都应：
  - 更新`AI-AGENT_working-status.md`，标注当前子环节与进度。
  - 编写/更新对应的单元测试、集成测试或验证脚本。
  - 即时记录新出现的技术债务、潜在风险与待确认事项。
- 遵循“先设计后实现”原则：如需要改动既有流程，先更新设计文档与流程图。
- 遇到阻塞或返工，说明原因、所回退环节及调整方案。
- 对每个子环节执行完成后，立刻检查git状态，准备原子化提交。

### 4. 验证结果
- 根据`optimized-task.md`和流程设计中的验证标准执行测试：
  - **单元测试**：覆盖核心逻辑与边界条件。
  - **集成/端到端测试**：验证模块间交互与真实场景。
  - **静态检查**：必要时运行lint、格式化、类型检查，确保无警告或明确记录例外。
- 确认所有测试通过并记录执行方式、命令、输出摘要。
- 若测试不通过或存在残留问题，追加状态记录并回到“任务主体流程循环”补救。

### 5. 文档更新
- 同步更新以下内容（视任务而定）：
  - 设计文档、流程图、接口说明。
  - `README.md`、`CHANGELOG.md`、`docs/`与`discuss/`目录内相关文档。
  - 运行脚本、配置样例、环境准备说明。
- 在项目根`AI-AGENT.md`或本文件记录新增约定、最佳实践、已知限制。
- 若改动影响到专业化代理分工或职责，及时注明并建议后续协作方案。

### 6. 收尾
- 清理调试用脚本、临时数据、冗余日志；确保仓库处于可提交状态。
- 对照TodoWrite中的待办项，确认每项都关联到对应的git提交。
- 维护语义化版本的`CHANGELOG.md`：将`[Unreleased]`内容移动到新版本号条目，并创建新的`[Unreleased]`区块。
- 完成后在状态文档写入最终记录，包括交付成果、性能指标、已解决的问题及后续建议。
- 恢复`now-task.md`为空模板，删除临时的`optimized-task.md`、`undetermined.md`等文件。

## 版本控制与分支管理
- **分支策略**：
  - `main/master`保持稳定；新功能使用`feature/...`分支，修复使用`fix/...`，验证或实验使用`test/...`。
  - 分支命名遵循`类型/简短描述`，如`feature/add-api-endpoint`。
  - 开始任务前确认当前分支正确，必要时创建新分支并记录在状态文档中。
- **提交规范**：
  - 每当完成“单个文件的重要修改”“独立功能模块”“阶段性成果”“问题修复”等步骤，必须立即提交。
  - 提交信息使用中文并遵循约定式格式（如`feat:`、`fix:`、`docs:`、`refactor:`），说明具体改动与影响。
  - 禁止将多个步骤的改动合并到一次提交；保持提交原子性，遇到跨文件改动需说明关联关系。
  - 与TodoWrite（或等效工具）同步：提交完成后立刻标记对应待办为完成。
- **变更审查**：
  - 在提交前运行必要的测试或静态检查，确保无未被追踪的临时文件。
  - 提交前检查`ai-agent-memory`内的指令文件是否需要同步更新；如有，单独成提交加以说明。

## Changelog与记录维护
- 遵循语义化版本，维持`CHANGELOG.md`的`[Unreleased]`区域。
- 每次功能/修复完成后，立即将变更条目写入对应分类（Added/Changed/Fixed/Removed）。
- 发布版本时，将`[Unreleased]`迁移为实际版本号并写入日期，同时创建新的`[Unreleased]`段落。
- 若任务涉及重要决策、约束或反复出现的风险，需在`AI-AGENT.md`或相关设计文档中记录原因与影响。

## 坏迹象识别与沟通
- 发现僵化、冗余、循环依赖等坏迹象时：
  1. 在状态文档或工作笔记记录问题及影响面。
  2. 提出可行的重构或优化建议，与用户确认后再执行。
  3. 若需大规模重构，先评估对现有流程的影响，必要时回退至流程设计环节。
- 对现有代码模块进行审阅时，至少检查：职责是否单一、接口是否精简、依赖是否可替换、测试覆盖是否充足。

## 专业化代理协作建议
- 项目进入不同阶段（如架构设计、性能优化、跨平台适配）时，评估是否需切换到更合适的专业化代理。
- 并行开发时，明确各代理的职责边界与交付接口，避免重复劳动或互相覆盖。
- 完成交接时，提供必要的设计文档、运行说明与测试结果，确保后续代理可直接承接。
