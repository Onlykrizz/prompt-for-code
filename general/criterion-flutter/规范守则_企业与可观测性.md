# 规范守则 - 企业与可观测性

## 项目类型
- 复杂业务Flutter应用：BFF+移动端、企业门户、内部工具，需要稳定性、监控与合规保障。

## 核心原则
### 1. 架构治理
- 使用模块化/分层结构，推荐 `feature-first` + `core`/`shared` 目录；跨项目使用 `melos` 管理Monorepo。
- 通过 Dependency Injection（`get_it`/`riverpod`）管理服务实例，保持可测试性。
- 文档化接口契约，对接后端 GraphQL/REST 时使用 `graphql_flutter` 或 `retrofit` + `chopper`。

### 2. 可观测性与日志
- 采用 `logger`、`flutter_bloc_observer` 或 `riverpod_observer` 统一日志输出。
- 集成 Crashlytics/Sentry 监控异常，配合 `flutter_logs` 或自定义Sink输出结构化日志。
- 使用 OpenTelemetry/Datadog Trace SDK（如 `opentelemetry-dart`）收集分布式链路信息。

### 3. 安全与合规
- 加密本地存储，使用 `flutter_secure_storage` 或 `cryptography`。
- 网络层开启证书绑定/SSL Pinning（`http` + `security_context`）。
- 隐私政策与数据权限需在应用内显式说明，遵循GDPR/CCPA要求。

## 运维流程
- CI/CD：GitHub Actions/Codemagic 配置多环境打包、自动化测试与发布审批；生成变更记录。
- Feature flag / Remote Config：使用 Firebase Remote Config、LaunchDarkly 等控制灰度发布。
- 性能监控：集成 Firebase Performance Monitoring 或 AppDynamics；关注启动时间、网络延迟、渲染速度。

## 项目结构建议
```
enterprise_app/
├── lib/
│   ├── app.dart
│   ├── core/
│   ├── features/
│   ├── shared/
│   └── env/
├── config/
│   ├── firebase_options.dart
│   └── remote_config_defaults.json
└── scripts/
    └── ci_release.sh
```

## 测试与质量保障
- 编写单元、集成、金丝雀测试；重要业务流程使用 `integration_test` 自动化。
- 在CI中运行 `flutter analyze`、`dart test`、`flutter test --coverage`；设定覆盖率阈值。
- 对关键功能执行可用性测试；对接端监控平台（如New Relic）进行用户体验跟踪。

## 参考资料
- [Flutter Logging Best Practices](https://blog.logrocket.com/flutter-logging-best-practices/)
- [Firebase Crashlytics & Performance Monitoring](https://firebase.google.com/docs/perf-mon)
- [OpenTelemetry for Flutter](https://www.zibtek.com/blog/observability-vs-monitoring-for-flutter-micro-frontends-distributed-tracing-with-opentelemetry/)
- [Flutter Security Practices](https://docs.flutter.dev/data-and-backend/secure-data)
- [Flutter DevOps Guide (Codemagic)](https://docs.codemagic.io/flutter-configuration/)
