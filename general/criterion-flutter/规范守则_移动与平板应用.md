# 规范守则 - 移动与平板应用

## 项目类型
- iOS/Android 原生体验的Flutter应用，包含手机与平板自适配场景。
- 典型需求：多主题/动态UI、离线能力、推送通知、深度链接。

## 核心原则
### 1. 架构与状态管理
- 采用分层架构（Presentation、Application、Domain、Infrastructure），保持业务逻辑和UI分离。
- 使用官方推荐的 [Riverpod](https://riverpod.dev/)、[Bloc](https://bloclibrary.dev/) 或 [Cubit](https://bloclibrary.dev/#/coreconcepts?id=cubit) 等成熟状态管理方案，结合`StateNotifier`/`Freezed`提高类型安全。
- 对异步操作使用 `Future`/`Stream`，必要时结合 `isolates` 或 `compute` 处理重度计算。

### 2. UI/UX 与响应式布局
- 遵循 Material 3 / Cupertino 设计体系，使用 `ThemeExtension` 统一样式。
- 借助 `LayoutBuilder`、`MediaQuery`、`AdaptiveLayout` 实现自适配；对平板使用自适应导航（NavigationRail）。
- 在动画与交互中使用 `ImplicitlyAnimatedWidget` 或 `AnimationController` + `TickerProvider`，避免滥用`setState`。

### 3. 本地存储与安全
- 采用 `shared_preferences`/`hive` 管理轻量数据，敏感数据使用 `flutter_secure_storage`。
- 推送/后台任务遵循平台差异化：Android 使用 WorkManager，iOS 使用 BGTaskScheduler。
- 深度链接使用 `go_router` / `RouteInformationParser` 统一导航栈。

## 项目结构建议
```
mobile_app/
├── lib/
│   ├── main.dart
│   ├── app.dart
│   ├── presentation/
│   │   ├── feature_home/
│   │   └── widgets/
│   ├── application/
│   ├── domain/
│   └── infrastructure/
├── android/
├── ios/
├── test/
│   └── ...
└── integration_test/
```

## 测试与交付
- 单元测试：`flutter test` 配合 `mocktail`、`bloc_test` 验证状态逻辑。
- 集成测试：`integration_test` + `flutter drive`；关键路径接入Golden测试（`golden_toolkit`）。
- 可观察性：使用 `firebase_crashlytics`/`sentry_flutter` 收集崩溃与性能数据。
- CI/CD：使用 `fastlane` 或 Codemagic 实现签名、构建与发布流程，输出 Release Notes。

## 运维与监控
- 性能指标：启动时间、帧率（Jank < 5%）、内存占用。
- 使用 `flutter run --profile`、`DevTools` 监控性能热点；必要时分离`isolate`处理密集计算。
- 发布阶段执行 `flutter build ipa/apk/appbundle --obfuscate --split-debug-info`，保护源码并减少包体积。

## 参考资料
- [Flutter: Performance Best Practices](https://docs.flutter.dev/perf/best-practices)
- [Flutter Architectural Patterns](https://docs.flutter.dev/get-started/fession)
- [Bloc Library Documentation](https://bloclibrary.dev/)
- [Navigator 2.0 & go_router](https://docs.flutter.dev/cookbook/navigation/go-router)
- [Firebase Crashlytics for Flutter](https://firebase.google.com/docs/crashlytics/get-started?platform=flutter)
