# AI-AGENT_criterion.md

本指引适用于编程类任务的完整执行流程，所有沟通与记录统一使用简体中文。文档默认同步复制至 `ai-agent-memory/` 目录供实际任务使用。

## 1. 六环节概览
1. 任务前置准备
2. 流程设计
3. 任务主体流程循环
4. 验证结果
5. 文档更新
6. 收尾

## 2. 环节关键要求

### 1) 任务前置准备
- 阅读本指引、`Agents.md` 与当前目录下的模板。
- 梳理 now-task.md，按模板输出待定项与优化任务说明。
- 建立 `AI-AGENT_working-status.csv`，在每次状态变化后立即记录并提交。
- 依据任务复杂度调用 Sequential Thinking，必要时补充风险与依赖分析。
- 若需要外部资料，先检查指引后再调用 MCP 服务。

### 2) 流程设计
- 整理输入、输出、依赖与风险，形成流程草案或结构图。
- 对存在多方案的部分列出比选项，必要时写入待定项集中确认。
- 设计完成后更新 `optimized-task.md` 中的流程描述与验证标准。
- 核对前置环节的未解决问题，确保结论已整合。

### 3) 任务主体流程循环
- 按设计逐步执行，每完成关键子步骤立刻记录状态并提交。
- 将 TodoWrite 或等效工具与实际执行保持同步，完成后及时勾选。
- 新风险、阻塞或返工原因需写入状态文档与相关说明。
- 调整流程前先更新设计文档或流程图，并确认影响范围。

### 4) 验证结果
- 对照 `optimized-task.md` 的验证标准逐项检查。
- 运行必要的单元测试、集成测试、静态检查或演示。
- 记录测试命令与要点，若存在失败项需说明原因与后续计划。
- 验证完成后追加状态记录，并评估是否需要返工。

### 5) 文档更新
- 更新 README、CHANGELOG 及其他受影响文档。
- 状态文档更新后，优先维护 CHANGELOG：写入本次版本号与日期，重建空的 `[Unreleased]` 区块。
- 同步保存流程图、模板、讨论纪要等资料。
- 若项目约定有调整，需在 `Agents.md` 或本指引中补充说明。

### 6) 收尾
- 清理临时文件、调试脚本与冗余日志，保持仓库整洁。
- 恢复 `now-task.md` 为待填模板，保留 `ai-agent-output/` 内的工作档案。
- 确认工作状态记录、Todo、提交计划均已闭环。
- 写入最终状态记录，总结交付物、遗留风险与后续建议。

## 3. 验证与测试要点
- 单元测试：覆盖核心逻辑与关键边界。
- 集成/端到端测试：验证模块协作与真实场景。
- 静态检查：lint、格式化、类型检查；如需例外，记录原因。
- 文档校验：检查链接、流程图与说明是否匹配最新实现。

## 4. MCP 使用速览
| 环节 | 推荐工具 | 触发时机 |
| --- | --- | --- |
| 任务前置准备 | Sequential Thinking | 需求复杂、存在多方案或不确定点时 |
| 流程设计 | Sequential Thinking / Serena (只读) | 梳理结构或检索代码参考 |
| 任务主体 | Serena / Desktop Commander / Filesystem | 定位代码、编写脚本、编辑文件 |
| 验证结果 | Desktop Commander / Filesystem | 运行测试、读取日志或检查输出 |
| 文档更新 | Filesystem | 更新文档、维护记录 |

补充说明：
- **web-search / Context7**：当需要获取最新公开资料、官方文档或 API 说明时使用；注意限制查询范围并记录引用。
- **Playwright**：需要验证前端交互或获取动态页面内容时调用，操作前描述清楚目标元素与期望行为。
- **DeepWiki**：快速了解公共仓库结构或实现要点时使用，结果仅作参考，必要时再回到源码验证。
- **mcp-time**：用于生成精确时间戳，确保状态记录与日志可追溯。

> 说明：当前指令体系默认不再记录 user-temp 或 MCP 调用日志，如需记录，可根据团队约定自定义方案。

## 5. 模板与引用
- now-task 模板：`ai-agent-memory/now-task.md`
- 待定项模板：`ai-agent-memory/undetermined-template.md`
- 工作状态记录：`ai-agent-output/YYYY-MM-DDTHH-MM-SS_任务描述/AI-AGENT_working-status.csv`
- 优化任务说明：同目录下的 `optimized-task.md`

执行过程中若有新增约定或最佳实践，请在任务收尾前更新本文件。EOF
