# 规范守则 - 企业级平台与服务

## 项目类型
- 多业务域单体/模块化单体、SOA平台、企业资源管理系统、交易/结算/账务服务
- 技术栈：Spring Boot + Domain-Driven Design、Jakarta EE、Axon、DDD Starter、消息中间件（Kafka、RocketMQ）

## 治理与合规
- 维护架构决策记录（ADR），记录背景、备选方案、评估与结论。
- 落地企业级编码规范：
  - [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html) – 命名、编码风格。
  - [阿里巴巴 Java 开发手册](https://developer.aliyun.com/ebook/386) – 编程规约、异常日志、单元测试标准。
- 在 `CODEOWNERS` / 审批流中维护跨团队评审机制，关键业务模块需双人Review。
- 年度依赖审计：对JDK、第三方库、内部组件进行版本与许可证检查。

## 领域与模块设计
- 使用领域模型 + 聚合根 + 领域事件，避免贫血模型。
- 采用多模块结构：`domain-core`、`application`, `infrastructure`, `interfaces`；通过Gradle/Maven Enforcer约束依赖方向。
- 事件驱动：使用Outbox/CDC模式确保跨服务一致性。
- 业务规则写入Policy/Specification对象，与技术实现解耦。

## 数据与事务策略
- 优先使用领域服务＋仓储（Repository）抽象；禁止直接在Controller中操作Mapper。
- 跨库事务：Saga/补偿事务 + 可靠消息 + 幂等操作。
- 审计日志（谁、何时、做了什么）与合规日志（SOX、GDPR）分离。
- 敏感数据脱敏与分级授权，利用Jasypt、SM4等加密方案。

## 架构与发布
```
enterprise-platform/
├── build.gradle.kts
├── settings.gradle.kts
├── modules/
│   ├── domain-core/
│   ├── application-service/
│   ├── infra-persistence/
│   ├── infra-messaging/
│   └── interfaces-rest/
├── adr/
│   └── 0001-domain-event-transport.md
└── docs/
    ├── architecture-overview.md
    └── operations-playbook.md
```

## 测试与质量保障
- 单元测试覆盖业务规则；使用 [ArchUnit](https://www.archunit.org/) 保证分层依赖不被破坏。
- 合规测试：结合契约测试（Pact）、集成测试、回归测试；财务类系统执行并行双账验算。
- 质量门禁：静态扫描（SonarQube）、安全扫描（OWASP Dependency-Check）、代码格式化（google-java-format）。

## 运维与SRE
- SLO示例：核心交易成功率 ≥ 99.99%、对账偏差=0、日终批次在时限内完成。
- 变更管理：重大发布采用蓝绿或分区域灰度；记录变更单、回滚脚本与验证步骤。
- 自动化脚本管理：基础设施即代码（Terraform、Pulumi），权限最小化。
- 度量：业务指标（订单量、失败率）、系统指标（线程池、GC）、自定义事件（领域事件数）。

## 参考资料
- [Effective Java – Joshua Bloch](https://www.javaguides.net/2025/02/effective-java-15-best-practices.html)
- [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- [Alibaba Java 开发手册](https://developer.aliyun.com/ebook/386)
- [Domain-Driven Design Reference](https://domainlanguage.com/ddd/reference/) – 领域建模指导
- [Google SRE Workbook: Eliminating Toil](https://sre.google/workbook/eliminating-toil/) – 运维效率与变更管理
